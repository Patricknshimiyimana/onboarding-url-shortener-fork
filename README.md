# URL-Shortener

A Spring Boot service for shortening URLs. This service takes a long URL and generates a shortened version that redirects to the original URL.

## Technologies Used

This project utilizes a variety of technologies to provide a scalable and maintainable URL shortening service:

- **Backend:** Java 21, Spring Boot 3
- **Database:** PostgreSQL
- **Caching:** Redis
- **Build Tool:** Gradle
- **API Documentation:** Springdoc OpenAPI (Swagger)
- **Containerization:** Docker, Docker Compose
- **Orchestration:** Kubernetes (Helm)
- **Monitoring:** Prometheus, Grafana
- **Reverse Proxy:** Nginx
- **Testing:** JUnit 5, Testcontainers, Mockito

## Getting Started

There are multiple ways to run this project. Please ensure you have the prerequisite tools installed for the method you choose.

### Prerequisites

- Java 21
- Gradle 8.x
- Docker and Docker Compose (for containerized setup)
- `kubectl` and `helm` (for Kubernetes deployment)

### 1. Running with Gradle

This is the simplest way to run the application for development purposes.

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/IT-Impulse-onboarding/onboarding-url-shortener.git
    cd onboarding-url-shortener
    ```

2.  **Set up environment variables:**
    This project uses a `.env` file for configuration. You can create one from the example if one is provided, or create it manually.
    Create a file named `.env` in the project root with the following content:
    ```
    SERVER_PORT=8080
    POSTGRES_URL=jdbc:postgresql://localhost:5432/url_shortener_db
    POSTGRES_USER=user
    POSTGRES_PASSWORD=password
    ```
    You will need a local PostgreSQL instance running.

3.  **Run the application:**
    ```bash
    gradle bootRun
    ```
    The application will be accessible at `http://localhost:8080`.

    - Swagger Docs `http://localhost:8080/swagger-ui.html`

### 2. Running with Docker Compose

This method will start the application along with all its dependencies (PostgreSQL, Redis, etc.) in Docker containers.

1.  **Clone the repository.**

2.  **Set up environment variables:**
    Create a `.env` file in the project root. The `docker-compose.yml` is configured to use these variables.
    ```
    SERVER_PORT
    SERVER2_PORT
    POSTGRES_USER
    POSTGRES_PASSWORD
    POSTGRES_DB
    DB_PORT
    SPRING_REDIS_PORT
    NGINX_HOST_PORT
    NGINX_CONTAINER_PORT
    PROMETHEUS_PORT
    GRAFANA_PORT
    ALLOWED_ORIGIN
    POSTGRES_URL
    ```

3.  **Build and start the services:**
    ```bash
    docker-compose up --build -d
    ```

4.  **Accessing services:**
    - **Application (with Load Balancer):** `http://localhost:80`
    - **Grafana:** `http://localhost:3000`
    - **Prometheus:** `http://localhost:9090`

### 3. Deploying to Kubernetes

The project includes a Helm chart for easy deployment to a Kubernetes cluster.

1.  **Package the application:**
    You need to build the application and have a Docker image available in a registry that your Kubernetes cluster can access.

2.  **Configure deployment:**
    Modify the values in `deployment/Chart.yaml` and `deployment/templates/deployment.yaml` to match your environment and Docker image registry.

3.  **Deploy with Helm:**
    ```bash
    helm install url-shortener ./deployment
    ```

## Running Tests

You can run the test suite using Gradle:
```bash
gradle test
```
This will execute both unit and integration tests. Testcontainers are used to spin up PostgreSQL and Redis instances for the integration tests, so you need to have Docker running.

A test coverage report is generated by Jacoco. You can find it at `build/jacocoHtml/index.html` after running the command `gradle jacocoTestReport`.

## API Documentation

The API documentation using OpenAPI is available at:

- `http://localhost:8080/swagger-ui.html`

## Monitoring

The application is configured to expose metrics for Prometheus.
- **Metrics endpoint:** `http://localhost:8080/actuator/prometheus`
- **Prometheus dashboard:** `http://localhost:9090` (with Docker Compose)
- **Grafana dashboard:** `http://localhost:3000` (with Docker Compose)
A pre-configured data source for Prometheus in Grafana is included.

## Developers
- [Martial Mutabaruka](https://github.com/katros1)
- [Patrick Nshimiyimana](https://github.com/Patricknshimiyimana)
